blueprint:
  name: "â° Time Segment Sensor-driven Scenes"
  description: >
    ## â° Time Segment Sensor-driven Scenes

    *Version 0.0.8*

    Coordinate your scenes with the time of day using a Daily Time Segment Sensor. This blueprint allows you to assign scenes 
    for every phase in a day by using the Time Segment sensor's â€œTime Segmentâ€ attribute.

    Leave a scene selector empty to skip the scene activation for that time segment.
    
    <details>
    <summary><b>ğŸ“– Time Segments</b>: ğŸ‘ˆğŸ¼</summary>
      These time segments are set within the 'Time Segment Sensor' template sensor. If you need to edit them to suit your preferences,
      edit them in that sensor.
      
      <b>â˜€ï¸ Daytime Scenes</b>
        - Dayâ€“Early Light: Sunrise â€“ 8:00 AM
        - Dayâ€“Morning: 8:00 AM â€“ 11:45 AM
        - Dayâ€“Lunch: 11:45 AM â€“ 1:00 PM
        - Dayâ€“Afternoon: 1:00 PM â€“ 4:00 PM
        - Dayâ€“Golden Hour: 4:00 PM â€“ Sunset

      <b>ğŸŒ™ Nighttime Scenes</b>
        - Nightâ€“Evening: Sunset â€“ 10:00 PM
        - Nightâ€“Midnight: 10:00 PM â€“ 2 hours before Sunrise
        - Nightâ€“Predawn: 2 hours before Sunrise â€“ Sunrise
    </details>
  domain: automation
  input:
    trigger:
      name: "Time Segments Sensor"
      icon: mdi:clock-star-four-points-outline
      collapsed: true
      input:
        sensor_entity:
          name: "Sensor"
          description: "The Time Segment Sensor entity that provides the 'Time Segment' attribute."
          default: sensor.time_segment_sensor
          selector:
            entity:
              domain: sensor

    day_scene_config:
      name: "Daytime Scenes"
      icon: mdi:weather-partly-cloudy
      collapsed: true
      input:
        scene_day_early_light:
          name: "Early Light"
          description: "â˜€ï¸ Sunrise â€“ 8:00 AM"
          default: ""
          selector:
            entity:
              domain: scene
        scene_day_morning:
          name: "Morning"
          description: "â˜€ï¸ 8:00 AM â€“ 11:45 AM"
          default: ""
          selector:
            entity:
              domain: scene
        scene_day_lunch:
          name: "Lunch"
          description: "â˜€ï¸ 11:45 AM â€“ 1:00 PM"
          default: ""
          selector:
            entity:
              domain: scene
        scene_day_afternoon:
          name: "Afternoon"
          description: "â˜€ï¸ 1:00 PM â€“ 4:00 PM"
          default: ""
          selector:
            entity:
              domain: scene
        scene_day_golden_hour:
          name: "Golden Hour"
          description: "â˜€ï¸ 4:00 PM â€“ Sunset"
          default: ""
          selector:
            entity:
              domain: scene

    night_scene_config:
      name: "Nighttime Scenes"
      icon: mdi:weather-night
      collapsed: true
      input:
        scene_night_evening:
          name: "Evening"
          description: "ğŸŒ™ Sunset â€“ 10:00 PM"
          default: ""
          selector:
            entity:
              domain: scene
        scene_night_midnight:
          name: "Midnight"
          description: "ğŸŒ™ 10:00 PM â€“ 2 hours before Sunrise"
          default: ""
          selector:
            entity:
              domain: scene
        scene_night_predawn:
          name: "Pre-dawn"
          description: "ğŸŒ™ 2 hours before Sunrise â€“ Sunrise"
          default: ""
          selector:
            entity:
              domain: scene

triggers:
  - trigger: state
    id: t0
    entity_id: !input trigger.sensor_entity
    attribute: "Time Segment"

action:
  - choose:
      - conditions:
          - condition: template
            value_template: >
              {% set scene = !input day_scene_config.scene_day_early_light %}
              {{ scene != '' and trigger.to_state.attributes['Time Segment'] == 'Dayâ€“Early Light' }}
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input day_scene_config.scene_day_early_light
      - conditions:
          - condition: template
            value_template: >
              {% set scene = !input day_scene_config.scene_day_morning %}
              {{ scene != '' and trigger.to_state.attributes['Time Segment'] == 'Dayâ€“Morning' }}
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input day_scene_config.scene_day_morning
      - conditions:
          - condition: template
            value_template: >
              {% set scene = !input day_scene_config.scene_day_lunch %}
              {{ scene != '' and trigger.to_state.attributes['Time Segment'] == 'Dayâ€“Lunch' }}
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input day_scene_config.scene_day_lunch
      - conditions:
          - condition: template
            value_template: >
              {% set scene = !input day_scene_config.scene_day_afternoon %}
              {{ scene != '' and trigger.to_state.attributes['Time Segment'] == 'Dayâ€“Afternoon' }}
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input day_scene_config.scene_day_afternoon
      - conditions:
          - condition: template
            value_template: >
              {% set scene = !input day_scene_config.scene_day_golden_hour %}
              {{ scene != '' and trigger.to_state.attributes['Time Segment'] == 'Dayâ€“Golden Hour' }}
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input day_scene_config.scene_day_golden_hour
      - conditions:
          - condition: template
            value_template: >
              {% set scene = !input night_scene_config.scene_night_evening %}
              {{ scene != '' and trigger.to_state.attributes['Time Segment'] == 'Nightâ€“Evening' }}
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input night_scene_config.scene_night_evening
      - conditions:
          - condition: template
            value_template: >
              {% set scene = !input night_scene_config.scene_night_midnight %}
              {{ scene != '' and trigger.to_state.attributes['Time Segment'] == 'Nightâ€“Midnight' }}
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input night_scene_config.scene_night_midnight
      - conditions:
          - condition: template
            value_template: >
              {% set scene = !input night_scene_config.scene_night_predawn %}
              {{ scene != '' and trigger.to_state.attributes['Time Segment'] == 'Nightâ€“Predawn' }}
        sequence:
          - service: scene.turn_on
            target:
              entity_id: !input night_scene_config.scene_night_predawn
mode: single
